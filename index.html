<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Engrave On Ring — V6</title>

<link href="https://fonts.googleapis.com/css2?family=Allura&family=Abril+Fatface&family=Dancing+Script&family=Lobster&family=Lora&family=Pacifico&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&family=Quicksand:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --panel-bg:#fff; --bg:#f5f5f7; --text:#1d1d1f; --muted:#6e6e73; --accent:#0071e3; --radius:12px;
    --card:#f1f1f4; --card-border:#d2d2d7;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background:var(--bg); color:var(--text);}
  .wrap{max-width:1000px; margin:18px auto; display:grid; grid-template-columns:340px 1fr; gap:18px; padding:12px;}
  .panel{background:var(--panel-bg); border-radius:var(--radius); padding:14px; border:1px solid #d2d2d7;}
  h2{margin:0 0 8px 0; font-size:16px; font-weight:600;}
  label{display:block; margin-top:10px; margin-bottom:6px; font-weight:600; font-size:13px;}
  input[type="text"]{width:100%; padding:10px 12px; border-radius:8px; border:1px solid #d2d2d7; font-size:15px; background:#fff; color:var(--text);}
  .muted{color:var(--muted); font-size:13px; margin-top:6px;}
  .preview{background:transparent; display:flex; align-items:center; justify-content:center; min-height:520px; border-radius:var(--radius); position:relative;}
  .stage{position:relative; width:100%; max-width:760px;}
  img#ringImg{width:100%; display:block; border-radius:8px;}
  svg.overlay{position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; overflow:visible;}
  .toolbar{
    position:absolute; left:0; right:0; top:-56px;
    display:flex; align-items:center; gap:10px; padding:8px 10px;
    background:var(--panel-bg); border:1px solid var(--card-border); border-radius:10px;
    box-shadow:0 2px 8px rgba(0,0,0,.06);
  }
  .tool{display:flex; align-items:center; gap:8px; font-size:13px; white-space:nowrap;}
  .tool input[type="range"]{width:180px;}
  .tool .val{min-width:36px; text-align:right; font-variant-numeric:tabular-nums; color:var(--muted);}
  /* font cards */
  .font-grid{display:grid; grid-template-columns:repeat(3, 1fr); gap:8px; margin-top:8px;}
  .font-card{
    border:1px solid var(--card-border); background:var(--card);
    border-radius:10px; padding:10px; cursor:pointer; user-select:none;
    display:flex; align-items:center; justify-content:center; height:56px;
    transition:transform .05s ease, border-color .15s ease, background .15s ease;
    text-align:center; font-size:14px; color:var(--text);
  }
  .font-card:hover{transform:translateY(-1px);}
  .font-card.active{outline:2px solid var(--accent); background:#eef5ff;}
  .tip{font-size:12px; color:var(--muted); margin-top:10px;}

  ```css
  /* ========== START: Symbol Styles (เพิ่มส่วนนี้เข้าไป) ========== */
  .symbol-section{
    margin-top: 14px;
  }
  .symbol-label{
    font-weight: 600; font-size: 13px; margin-bottom: 6px; display: block;
  }
  .symbol-grid{
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .symbol-btn{
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    border: 1px solid var(--card-border);
    background: var(--card);
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    user-select: none;
    font-size: 16px;
    min-width: 40px;
    text-align: center;
    transition: all .15s ease;
  }
  .symbol-btn:hover{
    transform: translateY(-1px);
    border-color: #b3b3b3;
  }
  .symbol-btn.copied {
    background-color: #d4edda; /* สีเขียวอ่อน */
    border-color: #c3e6cb;
    color: #155724;
  }
  /* ========== END: Symbol Styles ========== */

  /* Responsive - IMPROVED SECTION */
  @media (max-width: 860px){
    .wrap{
      grid-template-columns:1fr;
      padding:8px; /* [FIX] ลด Padding ด้านข้างสำหรับมือถือ */
    }
    .toolbar{
      position:static;
      margin-bottom:12px;
      flex-wrap: wrap; /* [FIX] ทำให้ Toolbar ตัดบรรทัดได้เมื่อที่แคบ */
      justify-content: center; /* [FIX] จัดให้อยู่กลางเมื่อตัดบรรทัด */
      gap: 12px 18px;
    }
    .tool input[type="range"]{
      width:150px; /* [TWEAK] ลดความกว้าง Slider เล็กน้อย */
    }
    .font-grid{
      /* [MAJOR FIX] เปลี่ยนเป็น 2 คอลัมน์สำหรับมือถือ เพื่อให้กดง่ายขึ้น */
      grid-template-columns: repeat(2, 1fr);
    }
    .preview{
      min-height:0; /* [TWEAK] ปรับ min-height ให้น้อยลง */
      padding-top:20px;
      padding-bottom:20px;
    }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="panel" role="region" aria-label="Controls">
    <h2>Engraving Controls</h2>
    <label for="engraveText">Text (max 34)</label>
    <input id="engraveText" type="text" maxlength="34" value="Forever & Ever">
        <div class="symbol-section">
      <label class="symbol-label">Add a symbol:</label>
      <div id="symbolGrid" class="symbol-grid">
        <button class="symbol-btn" data-symbol="♡">♡</button>
        <button class="symbol-btn" data-symbol="♥">♥</button>
        <button class="symbol-btn" data-symbol="∞">∞</button>
      </div>
    </div>
    ```
    <div class="muted">Characters left: <strong id="charsLeft">0</strong></div>

    <label>Choose a font</label>
    <div id="fontGrid" class="font-grid" role="listbox" aria-label="Choose a font">
      <div class="font-card" role="option" data-family="'Allura', cursive" style="font-family:'Allura', cursive">Allura</div>
      <div class="font-card" role="option" data-family="'Calisto MT', serif" style="font-family:'Calisto MT', serif">Calisto MT</div>
      <div class="font-card" role="option" data-family="'Lucida Calligraphy', 'Lucida Calligraphy Italic', cursive" style="font-family:'Lucida Calligraphy', 'Lucida Calligraphy Italic', cursive">Lucida</div>
      <div class="font-card" role="option" data-family="'Pacifico', cursive" style="font-family:'Pacifico', cursive">Pacifico</div>
      <div class="font-card" role="option" data-family="'Playfair Display', serif" style="font-family:'Playfair Display', serif">Playfair</div>
      <div class="font-card" role="option" data-family="'Dancing Script', cursive" style="font-family:'Dancing Script', cursive">Dancing</div>
      <div class="font-card" role="option" data-family="'Lobster', cursive" style="font-family:'Lobster', cursive">Lobster</div>
      <div class="font-card" role="option" data-family="'Abril Fatface', serif" style="font-family:'Abril Fatface', serif">Abril</div>
      <div class="font-card" role="option" data-family="'Lora', serif" style="font-family:'Lora', serif">Lora</div>
      <div class="font-card" role="option" data-family="'Poppins', sans-serif" style="font-family:'Poppins', sans-serif">Poppins</div>
      <div class="font-card" role="option" data-family="'Quicksand', sans-serif" style="font-family:'Quicksand', sans-serif">Quicksand</div>
    </div>
    <div class="tip">Tip: แตะการ์ดฟอนต์เพื่อเปลี่ยนฟอนต์อย่างรวดเร็ว</div>
  </div>

  <div class="panel preview" role="region" aria-label="Preview">
    <div class="stage" id="stage">
      <!-- Toolbar placed above the image -->
      <div class="toolbar" id="toolbar">
        <div class="tool">
          <span>Font size:</span>
          <input id="fontSize" type="range" min="10" max="48" value="21">
          <span class="val"><span id="fontSizeLabel">21</span> px</span>
        </div>
        <div class="tool" title="ปรับละเอียดตำแหน่งแนวตั้ง">
          <span>Fine‑tune Y:</span>
          <input id="vOffset" type="range" min="-60" max="60" value="-6">
          <span class="val">v: <span id="vOffsetUnit">-6</span></span>
        </div>
      </div>

      <img id="ringImg" src="ring.png" alt="ring image">
      <svg class="overlay" id="overlaySVG" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
        <defs><path id="engravePath" d="" fill="none"></path></defs>
        <text id="svgText" style="font-size:21px; text-anchor:middle; fill:#111;">
          <textPath id="textPath" href="#engravePath" startOffset="50%"></textPath>
        </text>
      </svg>
    </div>
  </div>
</div>

<script>
/* Elements */
const MAX = 34;
const img = document.getElementById('ringImg');
const svg = document.getElementById('overlaySVG');
const pathEl = document.getElementById('engravePath');
const textPath = document.getElementById('textPath');
const svgText = document.getElementById('svgText');

const inputText = document.getElementById('engraveText');
const charsLeft = document.getElementById('charsLeft');

const fontSize = document.getElementById('fontSize');
const fontSizeLabel = document.getElementById('fontSizeLabel');

const vOffset = document.getElementById('vOffset');
const vOffsetUnit = document.getElementById('vOffsetUnit');

const fontGrid = document.getElementById('fontGrid');

/* initial UI values */
charsLeft.textContent = MAX - (inputText.value?.length || 0);
fontSizeLabel.textContent = fontSize.value;
vOffsetUnit.textContent = vOffset.value;

/* Compute arc path inside ring */
function updateSVG() {
  const w = img.clientWidth || img.width;
  const h = img.clientHeight || img.height;
  svg.setAttribute('width', w);
  svg.setAttribute('height', h);
  svg.setAttribute('viewBox', `0 0 ${w} ${h}`);

  // padding left/right to avoid edges of ring reflection
  const padding = Math.max(18, w * 0.12);

  const leftX = padding+60;
  const rightX = w - (padding+60);

  // base center chosen for this ring photo; vertical offset slider moves it
  const baseCenterY = h * 0.58;

  const v = Number(vOffset.value); // -60..60
  // centerY computed in px: baseCenterY + (v/100) * h
  const centerY = baseCenterY + (v/100) * h;

  // rx: half width between left & right
  const rx = (rightX - leftX) / 2;
  // ry controlled by user for "tightness"
  const ry = 40; // keep stable; users adjust size/vertical only here

  // Build arc d (left to right). sweep-flag=0 so upper arc
  const d = `M ${leftX.toFixed(2)} ${centerY.toFixed(2)} A ${rx.toFixed(2)} ${ry.toFixed(2)} 0 0 1 ${rightX.toFixed(2)} ${centerY.toFixed(2)}`;
  pathEl.setAttribute('d', d);

  // update text content and style
  let txt = inputText.value || '';
  if (txt.length > MAX) {
    txt = txt.slice(0, MAX);
    inputText.value = txt;
  }
  textPath.textContent = txt;
  charsLeft.textContent = MAX - txt.length;

  // font size already bound
  svgText.style.fontSize = fontSize.value + 'px';
}

/* font cards logic */
function setActiveFontCard(card){
  [...fontGrid.querySelectorAll('.font-card')].forEach(c=>c.classList.remove('active'));
  card.classList.add('active');
  const family = card.getAttribute('data-family');
  svgText.style.fontFamily = family;
}

fontGrid.addEventListener('click', (e)=>{
  const card = e.target.closest('.font-card');
  if (!card) return;
  setActiveFontCard(card);
  updateSVG();
});

/* Default active font = first card */
setActiveFontCard(fontGrid.querySelector('.font-card[data-family]'));

/* Listeners */
inputText.addEventListener('input', updateSVG);
fontSize.addEventListener('input', ()=>{ fontSizeLabel.textContent = fontSize.value; updateSVG(); });
vOffset.addEventListener('input', ()=>{ vOffsetUnit.textContent = vOffset.value; updateSVG(); });

/* image load and resize */
img.addEventListener('load', ()=>{ setTimeout(updateSVG, 30); });
window.addEventListener('resize', ()=>{ setTimeout(updateSVG, 50); });

/* ========== START: Symbol Copy Logic (เพิ่มส่วนนี้เข้าไป) ========== */
const symbolGrid = document.getElementById('symbolGrid');

symbolGrid.addEventListener('click', (e) => {
  const btn = e.target.closest('.symbol-btn');
  if (!btn) return;

  const symbol = btn.dataset.symbol;

  // ใช้ Clipboard API ในการ copy
  navigator.clipboard.writeText(symbol).then(() => {
    // ---- Feedback ให้ผู้ใช้รู้ว่า Copy สำเร็จ ----
    const originalText = btn.textContent;
    btn.textContent = 'Copied!';
    btn.classList.add('copied');
    btn.disabled = true;

    // เปลี่ยนกลับเป็นเหมือนเดิมใน 1.5 วินาที
    setTimeout(() => {
      btn.textContent = originalText;
      btn.classList.remove('copied');
      btn.disabled = false;
    }, 1500);

  }).catch(err => {
    console.error('Failed to copy symbol: ', err);
    // อาจจะแจ้งเตือนผู้ใช้ว่าไม่สำเร็จ
    alert('Could not copy symbol.');
  });
});
/* ========== END: Symbol Copy Logic ========== */
  
/* init */
if (img.complete) { updateSVG(); }
else { img.addEventListener('load', updateSVG); }
</script>
</body>
</html>
